<h4>Nueva Solicitud</h4>
<div class="card card-body">
    <div class="row g-2">
        <div class="col-md-3">
            <label>Cliente</label>
            <select id="cli" class="form-select">
                <option value="">Seleccione un cliente</option>
                @foreach (var c in (IEnumerable<dynamic>)ViewBag.Clientes)
                {
                    <option value="@c.Id" data-ident="@c.Identificacion">@c.Texto</option>
                }
            </select>
        </div>
        <div class="col-md-3">
            <label>Identificación</label>
            <input id="ide" class="form-control" placeholder="10101010" readonly />
        </div>
        <div class="col-md-3"><label>Monto</label><input id="mon" class="form-control" type="number" /></div>
        <div class="col-md-12"><label>Comentarios</label><textarea id="com" class="form-control"></textarea></div>
    </div>
    <button class="btn btn-primary mt-2" onclick="guardar()">Guardar</button>
    <a class="btn btn-secondary mt-2" asp-action="Index">Volver</a>
</div>

<script>
    function guardar() {
        const fd = new URLSearchParams();
        fd.append('clienteId', cli.value);
        fd.append('identificacion', ide.value);
        fd.append('monto', mon.value);
        fd.append('comentarios', com.value);
        fetch('@Url.Action("CrearPost")', { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: fd })
            .then(r => r.json()).then(d => {
                if (d.esError) Swal.fire('Regla de negocio', d.mensaje, 'warning');
                else Swal.fire('OK', 'Gestión ' + d.data.id + ' creada', 'success').then(() => location.href = '@Url.Action("Index")');
            });
    }
</script>
